<div>
    <app-header title="Settings" description="Manage your account" />
    <div class="flex flex-col justify-center items-center">
        <div class="px-0 sm:px-10 flex flex-col items-center w-full border-t-1 border-gray-100">
            <h3 class="text-xl font-bold">Password</h3>
            <p class="font-medium text-gray-700">Change your password</p>
            <form [formGroup]="changePasswordForm" (ngSubmit)="submitChangePassword(
        changePasswordForm.value.oldPassword!,
        changePasswordForm.value.newPassword!,
        changePasswordForm.value.retypePassword!
      )">
                <label for="oldPassword" class="text-xs font-medium text-gray-700">Current password</label>
                <input type="password" id="oldPassword" formControlName="oldPassword"
                    class="mt-1 block w-60 rounded-md border-gray-300 shadow-sm focus:border-gray-600">

                @if (changePasswordForm.get('oldPassword')?.touched && changePasswordForm.get('oldPassword')?.invalid) {
                <div class="text-red-500 text-xs w-60">
                    @if (changePasswordForm.get('oldPassword')?.errors?.['required']) {
                    <span>Current password is required.</span>
                    }
                    @if (changePasswordForm.get('oldPassword')?.errors?.['minlength']) {
                    <span>Current password must be at least 8 characters long.</span>
                    }
                </div>
                }
                <label for="newPassword" class="text-xs font-medium text-gray-700">New password</label>
                <input type="password" id="newPassword" formControlName="newPassword"
                    class="mt-1 block w-60 rounded-md border-gray-300 shadow-sm focus:border-gray-600">

                @if (changePasswordForm.get('newPassword')?.touched && changePasswordForm.get('newPassword')?.invalid) {
                <div class="text-red-500 text-xs w-60">
                    @if (changePasswordForm.get('newPassword')?.errors?.['required']) {
                    <span>New password is required.</span>
                    }
                    @if (changePasswordForm.get('newPassword')?.errors?.['minlength']) {
                    <span>New password must be at least 8 characters long.</span>
                    }
                </div>
                }
                <label for="retypePassword" class="text-xs font-medium text-gray-700">Retype password</label>
                <input type="password" id="retypePassword" formControlName="retypePassword"
                    class="mt-1 block w-60 rounded-md border-gray-300 shadow-sm focus:border-gray-600">

                @if (changePasswordForm.get('retypePassword')?.touched &&
                changePasswordForm.get('retypePassword')?.invalid) {
                <div class="text-red-500 text-xs w-60">
                    @if (changePasswordForm.get('retypePassword')?.errors?.['required']) {
                    <span>Retyped password is required.</span>
                    }
                    @if (changePasswordForm.get('retypePassword')?.errors?.['minlength']) {
                    <span>Retyped password must be at least 8 characters long.</span>
                    }
                </div>
                }
                <button type="submit" [disabled]="changePasswordForm.invalid"
                    class="w-60 my-2 inline-flex justify-center rounded-md border border-transparent bg-green-500 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-green-700 hover:cursor-pointer">
                    Save
                </button>
                @if (errorChangePassword) {
                <div class="text-red-600 text-xs w-60 my-2">
                    {{ errorChangePassword }}
                </div>
                }
            </form>
        </div>
        <div class="px-0 sm:px-10 flex flex-col items-center w-full border-t-1 border-gray-100">
            <h3 class="text-xl font-bold">Delete your account</h3>
            <p class="font-medium text-gray-700">This action is irreversible</p>
            <button (click)="changeActive()"
                class="w-60 my-2 inline-flex justify-center rounded-md border border-transparent bg-red-500 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-red-700 hover:cursor-pointer">Delete
            </button>
        </div>
    </div>
    @if(deletePopupActive){
    <div class="fixed inset-0 flex items-center justify-center z-50 bg-black/30">
        <div class="bg-white rounded-2xl shadow-lg p-6 w-96">
            <h2 class="text-xl font-bold text-gray-800">Are you sure?</h2>
            <p class="text-gray-600 mt-2">
                This action cannot be undone. Your account will be permanently deleted.
            </p>

            <form [formGroup]="deleteForm" (ngSubmit)="deleteUser(deleteForm.value.password!)">
                <label for="password" class="block text-sm font-medium text-gray-700 mt-4">
                    Confirm password
                </label>
                <input formControlName="password" type="password" id="password" name="password" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-gray-600" />
                @if(deleteError){
                <p class="text-sm text-red-600 mt-2">
                    {{ deleteError }}
                </p>
                }
                <div class="mt-4 flex justify-end space-x-2">
                    <button type="button" (click)="changeActive()"
                        class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700">
                        Delete
                    </button>
                </div>
            </form>
        </div>
    </div>
    }
</div>